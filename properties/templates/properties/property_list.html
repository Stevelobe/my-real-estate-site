{% extends "base.html" %}
{% load static %}

{% block title %}Properties for Sale - FAKEMA Real Estate{% endblock %}

{% block content %}
    <section style="background-color: #007bff; color: white; padding: 30px 20px; text-align: center;">
        <h1>Our Properties</h1>
        <p>Find your dream home or investment property.</p>
    </section>

    <section style="padding: 40px 0;">
        <div class="container">
            <form method="GET" action="{% url 'properties:property_list' %}" style="background-color: white; padding: 20px; border: 1px solid #ddd; margin-bottom: 30px; display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                <input type="text" name="q" placeholder="Search by title, location..." value="{{ query_params.q|default:'' }}">
                <select name="type">
                    <option value="">All Types</option>
                    {% for type in property_types %}
                    <option value="{{ type.name }}" {% if query_params.type == type.name %}selected{% endif %}>{{ type.name }}</option>
                    {% endfor %}
                </select>
                <input type="number" name="min_price" placeholder="Min Price" value="{{ query_params.min_price|default:'' }}">
                <input type="number" name="max_price" placeholder="Max Price" value="{{ query_params.max_price|default:'' }}">
                <input type="number" name="bedrooms" placeholder="Min Beds" value="{{ query_params.bedrooms|default:'' }}">
                <input type="number" name="bathrooms" placeholder="Min Baths" value="{{ query_params.bathrooms|default:'' }}">
                <button type="submit" class="btn" style="grid-column: 1 / -1;">Apply Filters</button>
            </form>

            {% if page_obj %}
            <div class="grid-container">
                {% for property in page_obj %}
                <div class="card">
                    <a href="{% url 'properties:property_detail' property.slug %}">
                        {% if property.images.first %}
                        <img src="{% static 'img/place.jpg' %}" alt="Placeholder Image" style="width:100%; height: 150px; object-fit: cover;">
                        {% else %}
                        <img src="{% static 'img/place.jpg' %}" alt="Placeholder" style="width:100%; height: 200px; object-fit: cover;">
                        {% endif %}
                    </a>
                    <h3><a href="{% url 'properties:property_detail' property.slug %}">{{ property.title }}</a></h3>
                    <p>{{ property.location }}</p>
                    <p>Price: FCFA {{ property.price }}</p>
                    <p>Beds: {{ property.bedrooms }}, Baths: {{ property.bathrooms }}, Area: {{ property.area_sqm|default:"N/A" }}mÂ²</p>
                    <a href="{% url 'properties:property_detail' property.slug %}" class="btn">View Details</a>
                </div>
                {% endfor %}
            </div>

            <div class="pagination">
                {% if page_obj.has_previous %}
                    <a href="?page={{ page_obj.previous_page_number }}{% for key, value in query_params.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">&laquo; Previous</a>
                {% endif %}

                <span>Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>

                {% if page_obj.has_next %}
                    <a href="?page={{ page_obj.next_page_number }}{% for key, value in query_params.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">Next &raquo;</a>
                {% endif %}
            </div>
            {% else %}
            <p style="text-align: center;">No properties found matching your criteria.</p>
            {% endif %}
        </div>
    </section>
{% endblock %}